<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 750" style="font-family: 'Virgil', 'Segoe Print', 'Comic Sans MS', cursive; background: #ffffff;">
  <defs>
    <marker id="arrow3" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 Z" fill="#495057"/>
    </marker>
    <marker id="arrow3-green" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 Z" fill="#2b8a3e"/>
    </marker>
    <marker id="arrow3-blue" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 Z" fill="#1971c2"/>
    </marker>
    <filter id="shadow3">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-size="24" font-weight="bold" fill="#1e1e1e">GitOps Bridge Pattern</text>
  <text x="600" y="62" text-anchor="middle" font-size="14" fill="#868e96">Terraform outputs flow through K8s Secret annotations to Helm values</text>

  <!-- Step 1: Terraform -->
  <rect x="60" y="100" width="300" height="200" rx="12" fill="#d3f9d8" stroke="#40c057" stroke-width="2" filter="url(#shadow3)"/>
  <text x="210" y="128" text-anchor="middle" font-size="17" font-weight="bold" fill="#2b8a3e">1. Terraform Outputs</text>
  <text x="80" y="160" font-size="12" fill="#495057">vpc_id = "vpc-abc123"</text>
  <text x="80" y="180" font-size="12" fill="#495057">eks_cluster_arn = "arn:aws:..."</text>
  <text x="80" y="200" font-size="12" fill="#495057">vault_addr = "https://vault.."</text>
  <text x="80" y="220" font-size="12" fill="#495057">kafka_bootstrap = "b-1.msk.."</text>
  <text x="80" y="240" font-size="12" fill="#495057">iam_role_arns = { eso, dns, .. }</text>
  <text x="80" y="260" font-size="12" fill="#495057">repo_url = "https://github.."</text>
  <rect x="75" y="270" width="250" height="20" rx="4" fill="#ebfbee" stroke="#40c057" stroke-width="1"/>
  <text x="200" y="284" text-anchor="middle" font-size="10" fill="#2b8a3e">infrastructure/locals.tf assembles metadata</text>

  <!-- Arrow 1→2 -->
  <path d="M 360 200 L 440 200" stroke="#2b8a3e" stroke-width="2.5" marker-end="url(#arrow3-green)"/>
  <text x="400" y="190" text-anchor="middle" font-size="11" fill="#2b8a3e">gitops-bridge</text>
  <text x="400" y="204" text-anchor="middle" font-size="11" fill="#2b8a3e">module</text>

  <!-- Step 2: K8s Secret -->
  <rect x="450" y="100" width="300" height="200" rx="12" fill="#d0ebff" stroke="#1971c2" stroke-width="2" filter="url(#shadow3)"/>
  <text x="600" y="128" text-anchor="middle" font-size="17" font-weight="bold" fill="#1864ab">2. K8s Secret (argocd)</text>
  <text x="470" y="155" font-size="11" fill="#868e96">metadata:</text>
  <text x="480" y="172" font-size="11" fill="#495057">name: cluster-metadata</text>
  <text x="480" y="189" font-size="11" fill="#495057">namespace: argocd</text>
  <text x="480" y="206" font-size="11" fill="#868e96">labels:</text>
  <text x="490" y="223" font-size="11" fill="#1971c2">argocd.argoproj.io/secret-type: cluster</text>
  <text x="480" y="240" font-size="11" fill="#868e96">annotations:</text>
  <text x="490" y="257" font-size="11" fill="#495057">vpc_id: "vpc-abc123"</text>
  <text x="490" y="274" font-size="11" fill="#495057">vault_addr: "https://vault.."</text>
  <text x="490" y="291" font-size="11" fill="#495057">iam_eso_arn: "arn:aws:iam::..."</text>

  <!-- Arrow 2→3 -->
  <path d="M 750 200 L 830 200" stroke="#1971c2" stroke-width="2.5" marker-end="url(#arrow3-blue)"/>
  <text x="790" y="190" text-anchor="middle" font-size="11" fill="#1971c2">cluster</text>
  <text x="790" y="204" text-anchor="middle" font-size="11" fill="#1971c2">generator</text>

  <!-- Step 3: ApplicationSet -->
  <rect x="840" y="100" width="320" height="200" rx="12" fill="#fff3bf" stroke="#f59f00" stroke-width="2" filter="url(#shadow3)"/>
  <text x="1000" y="128" text-anchor="middle" font-size="17" font-weight="bold" fill="#e67700">3. ApplicationSet</text>
  <text x="860" y="155" font-size="11" fill="#868e96">generators:</text>
  <text x="870" y="172" font-size="11" fill="#868e96">- clusters:</text>
  <text x="880" y="189" font-size="11" fill="#495057">selector: environment=dev</text>
  <text x="860" y="210" font-size="11" fill="#868e96">template:</text>
  <text x="870" y="227" font-size="11" fill="#868e96">spec.source.helm.values:</text>
  <text x="880" y="244" font-size="11" fill="#e67700">vpc_id: '{{metadata.annotations.vpc_id}}'</text>
  <text x="880" y="261" font-size="11" fill="#e67700">vault: '{{metadata.annotations.vault_addr}}'</text>
  <text x="880" y="278" font-size="11" fill="#e67700">iam: '{{metadata.annotations.iam_*}}'</text>

  <!-- Arrow 3 → Addon Charts -->
  <path d="M 1000 300 L 1000 370" stroke="#e67700" stroke-width="2.5" marker-end="url(#arrow3)"/>
  <text x="1020" y="340" font-size="11" fill="#e67700">generates</text>
  <text x="1020" y="354" font-size="11" fill="#e67700">Application</text>

  <!-- Step 4: Addon Helm Charts -->
  <rect x="60" y="380" width="1100" height="180" rx="12" fill="#f8f9fa" stroke="#adb5bd" stroke-width="2" filter="url(#shadow3)"/>
  <text x="600" y="408" text-anchor="middle" font-size="17" font-weight="bold" fill="#495057">4. Addon Helm Charts (packages/)</text>
  <text x="600" y="428" text-anchor="middle" font-size="12" fill="#868e96">Each addon receives dynamic values from cluster annotations</text>

  <!-- Addon boxes -->
  <rect x="80" y="445" width="120" height="50" rx="6" fill="#d0ebff" stroke="#1971c2" stroke-width="1.5"/>
  <text x="140" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#1864ab">ArgoCD</text>
  <text x="140" y="484" text-anchor="middle" font-size="9" fill="#495057">repo_url, sso</text>

  <rect x="215" y="445" width="120" height="50" rx="6" fill="#d0ebff" stroke="#1971c2" stroke-width="1.5"/>
  <text x="275" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#1864ab">Flux CD</text>
  <text x="275" y="484" text-anchor="middle" font-size="9" fill="#495057">git source</text>

  <rect x="350" y="445" width="120" height="50" rx="6" fill="#d3f9d8" stroke="#40c057" stroke-width="1.5"/>
  <text x="410" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#2b8a3e">ESO</text>
  <text x="410" y="484" text-anchor="middle" font-size="9" fill="#495057">iam_arn, region</text>

  <rect x="485" y="445" width="120" height="50" rx="6" fill="#d3f9d8" stroke="#40c057" stroke-width="1.5"/>
  <text x="545" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#2b8a3e">Vault</text>
  <text x="545" y="484" text-anchor="middle" font-size="9" fill="#495057">vault_addr, kms</text>

  <rect x="620" y="445" width="120" height="50" rx="6" fill="#ffe8cc" stroke="#e8590c" stroke-width="1.5"/>
  <text x="680" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#d9480f">Kafka</text>
  <text x="680" y="484" text-anchor="middle" font-size="9" fill="#495057">bootstrap_servers</text>

  <rect x="755" y="445" width="120" height="50" rx="6" fill="#ffe3e3" stroke="#e03131" stroke-width="1.5"/>
  <text x="815" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#c92a2a">OPA/Policy</text>
  <text x="815" y="484" text-anchor="middle" font-size="9" fill="#495057">rego policies</text>

  <rect x="890" y="445" width="120" height="50" rx="6" fill="#d0bfff" stroke="#7950f2" stroke-width="1.5"/>
  <text x="950" y="468" text-anchor="middle" font-size="12" font-weight="bold" fill="#5f3dc4">Backstage</text>
  <text x="950" y="484" text-anchor="middle" font-size="9" fill="#495057">github, keycloak</text>

  <!-- Additional row -->
  <rect x="80" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="140" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">Keycloak</text>

  <rect x="215" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="275" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">cert-manager</text>

  <rect x="350" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="410" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">external-dns</text>

  <rect x="485" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="545" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">ingress-nginx</text>

  <rect x="620" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="680" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">Rancher</text>

  <rect x="755" y="505" width="120" height="40" rx="6" fill="#eebefa" stroke="#9c36b5" stroke-width="1.5"/>
  <text x="815" y="530" text-anchor="middle" font-size="11" font-weight="bold" fill="#862e9c">AI Platform</text>

  <!-- Bootstrap flow at bottom -->
  <rect x="120" y="600" width="960" height="100" rx="10" fill="#fff9db" stroke="#f59f00" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="600" y="625" text-anchor="middle" font-size="15" font-weight="bold" fill="#e67700">Bootstrap Sequence (scripts/bootstrap.sh)</text>

  <rect x="140" y="640" width="140" height="40" rx="6" fill="#fff3bf" stroke="#f59f00" stroke-width="1.5"/>
  <text x="210" y="664" text-anchor="middle" font-size="11" fill="#e67700">1. Helm install ArgoCD</text>

  <path d="M 280 660 L 310 660" stroke="#f08c00" stroke-width="1.5" marker-end="url(#arrow3)"/>

  <rect x="320" y="640" width="160" height="40" rx="6" fill="#fff3bf" stroke="#f59f00" stroke-width="1.5"/>
  <text x="400" y="664" text-anchor="middle" font-size="11" fill="#e67700">2. Helm install ESO</text>

  <path d="M 480 660 L 510 660" stroke="#f08c00" stroke-width="1.5" marker-end="url(#arrow3)"/>

  <rect x="520" y="640" width="170" height="40" rx="6" fill="#fff3bf" stroke="#f59f00" stroke-width="1.5"/>
  <text x="605" y="664" text-anchor="middle" font-size="11" fill="#e67700">3. ESO pulls secrets</text>

  <path d="M 690 660 L 720 660" stroke="#f08c00" stroke-width="1.5" marker-end="url(#arrow3)"/>

  <rect x="730" y="640" width="180" height="40" rx="6" fill="#fff3bf" stroke="#f59f00" stroke-width="1.5"/>
  <text x="820" y="664" text-anchor="middle" font-size="11" fill="#e67700">4. Apply ApplicationSet</text>

  <path d="M 910 660 L 940 660" stroke="#f08c00" stroke-width="1.5" marker-end="url(#arrow3)"/>

  <rect x="945" y="640" width="120" height="40" rx="6" fill="#d3f9d8" stroke="#40c057" stroke-width="1.5"/>
  <text x="1005" y="664" text-anchor="middle" font-size="11" fill="#2b8a3e">5. All addons up</text>

  <!-- Key insight -->
  <rect x="60" y="720" width="1100" height="25" rx="5" fill="#e7f5ff" stroke="#1971c2" stroke-width="1"/>
  <text x="600" y="738" text-anchor="middle" font-size="12" fill="#1864ab">Key Insight: Terraform never directly manages K8s resources. The GitOps Bridge passes metadata as annotations, ArgoCD reconciles the actual state.</text>
</svg>