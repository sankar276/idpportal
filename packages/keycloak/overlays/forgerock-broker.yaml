# Keycloak Identity Broker configuration for ForgeRock
# Apply as a Keycloak realm import overlay
identityProviders:
  - alias: forgerock
    displayName: "Sign in with ForgeRock"
    providerId: oidc
    enabled: true
    trustEmail: true
    firstBrokerLoginFlowAlias: "first broker login"
    config:
      clientId: "${FORGEROCK_CLIENT_ID}"
      clientSecret: "${FORGEROCK_CLIENT_SECRET}"
      tokenUrl: "https://${FORGEROCK_DOMAIN}/oauth2/access_token"
      authorizationUrl: "https://${FORGEROCK_DOMAIN}/oauth2/authorize"
      logoutUrl: "https://${FORGEROCK_DOMAIN}/oauth2/connect/endSession"
      userInfoUrl: "https://${FORGEROCK_DOMAIN}/oauth2/userinfo"
      issuer: "https://${FORGEROCK_DOMAIN}/oauth2"
      defaultScope: "openid profile email"
      syncMode: "IMPORT"
      validateSignature: "true"
      useJwksUrl: "true"
      jwksUrl: "https://${FORGEROCK_DOMAIN}/oauth2/connect/jwk_uri"

identityProviderMappers:
  - name: forgerock-email
    identityProviderAlias: forgerock
    identityProviderMapper: oidc-user-attribute-idp-mapper
    config:
      claim: email
      user.attribute: email
  - name: forgerock-groups
    identityProviderAlias: forgerock
    identityProviderMapper: oidc-user-attribute-idp-mapper
    config:
      claim: groups
      user.attribute: groups
      syncMode: INHERIT
